# Explorative Datenanalyse
```{r}
#| include: false 
ch <- 5
quiz <- 0
```
```{r}
#| include: false
library(mosaic)
library(latex2exp)
```
```{r child="FarbSchema.qmd"}
```
```{r child="gg-margins.qmd"}
```
::: {.callout-tip .Lernergebnisse}
## Lernergebnisse dieses Kapitels

Nach erfolgreichem Abschluss dieses Kapitels sind Sie in der Lage,

-   Daten in RStudio zu importieren, insbesondere √ºber das CSVFormat;

-   zentrale Statistiken und Grafiken f√ºr kategoriale und metrische Variablen zu nutzen und zu interpretieren;

-   Verteilungsformen numerischer Daten unterscheiden zu k√∂nnen;

-   eine empirische Verteilungsfunktion interpretieren zu k√∂nnen;

-   den Zusammenhang zwischen Variablen darstellen und beschreiben zu k√∂nnen
:::

Wir beginnen mit dem Einlesen von Daten. Dazu wird der Beispielsdatensatz `tips.csv` ^[Bryant u. a. (1995), Practical Data Analysis -- Case Studies in Business Statistics] eingelesen. Dieser liegt im sogenannten CSV-Format (*comma separated values*) vor. Dieses Format ist sehr n√ºtzlich, um Daten auszutauschen, da es ein reines Textformat ist und auf allen Rechnern und Betriebssystemen gelesen werden kann. Wenn Sie `tips.csv` mit einem Texteditor √∂ffnen, sieht die Datei so aus:

```         
"total_bill";"tip";"sex";"smoker";"day";"time";"size"
16,99;1,01;"Female";"No";"Sun";"Dinner";2
10,34;1,66;"Male";"No";"Sun";"Dinner";3
21,01;3,5;"Male";"No";"Sun";"Dinner";3
23,68;3,31;"Male";"No";"Sun";"Dinner";2
24,59;3,61;"Female";"No";"Sun";"Dinner";4
25,29;4,71;"Male";"No";"Sun";"Dinner";4
...
```

In der ersten Zeile stehen die Namen der Variablen, danach kommen die einzelnen Beobachtungen. Die Werte sind mit Semikola getrennt, das Dezimaltrennzeichen ist das Komma. Zeichenketten stehen in doppelten Anf√ºhrungszeichen.

::: {.callout-tip .Tipp}
## Tipp

Variablennahmen sollten mit Buchstaben beginnen und keine Leeroder Sonderzeichen enthalten und auch Umlaute sollten vermieden werden.
:::

Die Datei kann mit `read.csv2()` eingelesen werden, diese Funktion liest ein sogenanntes deutsches CSV ein. In amerikanischen CSV-Dateien ist das Datentrennzeichen ein Komma (daher *comma separated values*) und das Dezimaltrennzeichen ein Punkt.

Der ganze Befehl sieht dann so aus:

```{r}
#| echo: true
tips <- read.csv2("data/tips.csv")
```

Ob `data/` vor dem Dateinamen steht, h√§ngt davon ab, ob Sie die Datei in einem Unterverzeichnis gespeichert haben (z. B. bei Verwendung der Projektdatei --- siehe Kapitel 2 R und RMarkdown).

::: {.callout-tip .Hinweis}
## Hinweis

Im Code oben ist `<-` der sogenannten Zuweisungspfeil. Das, wo der Pfeil herkommt (hier: was rechts davon steht), wird in dem Objekt abspeichert, wo der Pfeil hinzeigt (hier links davon).
:::

CSV-Dateien k√∂nnen aus Tabellenkalkulationsprogrammen abgespeichert werden. R kann aber auch viele andere Datenformate lesen.

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

√ñffnen Sie die Datei `tips.csv` in Excel (oder einem anderen Tabellenkalkulationsprogramm).
:::

::: {.callout-tip .Tipp}
## Tipp

Die L√∂sung (oder Erl√§uterung) finden Sie am Ende dieses Kapitels. -- Versuchen Sie stets, eine Aufgabe zun√§chst selbst zu l√∂sen, bevor Sie nachschlagen. Die aktive Auseinandersetzung ist Ihr Schl√ºssel zum Lernerfolg!
:::

Um erste Informationen zu dem Datensatz zu erhalten, k√∂nnen Sie den Befehl `str(tips)` verwenden.

```{r}
str(tips)
```

Eine Datentabelle (`data.frame`) kann aus mehreren Variablen (Spalten) mit gleicher Anzahl Beobachtungen (Zeilen) bestehen. 
Die Variablennamen finden Sie in der Spalte nach dem \$-Zeichen, dahinter steht der Variablentyp, gefolgt von den ersten Daten.

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Was unterscheidet die Variablentypen `int` und `num`?
:::

@tbl-variablentypen

| Typ    | Verwendung                                                       |
|:-------|:-----------------------------------------------------------------|
| chr    | *character*, Zeichenkette                                        |
| factor | Faktor (Zeichenkette mit wenigen unterschiedlichen Auspr√§gungen) |
| int    | *integer*, ganzzahlig                                            |
| num    | *numeric*, Gleitkommazahlen                                      |

: Variabltypen in R {#tbl-variablentypen}

F√ºr diesen Datensatz sammelte ein Keller √ºber mehrere Monate sein Trinkgeld. 
@tbl-tipsdata zeigt die darin abgespeichertern Variablen.

| Name           | Bedeutung               |
|:---------------|:------------------------|
| `total_bill`   | Rechnungsh√∂he in Dollar |
| `tip`   |Trinkgeld in Dollar |
| `sex`   | Geschlecht des Rechnungszahlenden |
| `smoker`   | Gab es Raucher:innen am Tisch? |
| `day`   | Wochentag |
| `time`   | Tageszeit |
| `size`   | Anzahl Personen am Tisch |

: Variablen des Datensatzes `tips.csv` {#tbl-tipsdata}

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Welches Skalenniveau haben die Variablen im Datensatz `tips.csv`?
:::

## Analyse kategorialer Daten

Im ersten Schritt besch√§ftigen wir mit der Analyse kategorialer Daten.
Wir werden verschiedene Grafiken wie S√§ulendiagramm, Balkendiagramm oder Mosaikplot kennenlernen. 
Kreis- oder Kuchendiagramme werden wir allerdings nicht anschauen. 
Die H√§ufigkeiten der verschiedenen Kategorien k√∂nnen absolut oder relativ (als Anteile oder Prozente) angegeben werden.

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Warum werden Kreisdiagramme insbesondere in der
Wissenschaft nicht gerne gesehen?
:::

### H√§ufigkeiten und Anteile

S√§ulendiagrammewerden mit `gf_bar( ~ my.x, data = my.data)` ausgef√ºhrt,
`my.x` ist die Variable, die dargestellt werden soll (z. B. `day`),`my.data`
die Datentabelle, die verwendet werden soll (z. B.`tips`).

::: {.callout-tip .Tipp}
## Tipp
Zur Erinnerung: Die Tilde ~ wird auf Windows-Rechnern mit der Tastenkombination
AltGr - + ausgew√§hlt, auf Mac-Rechnern mit Alt - n.
:::

Wenn wir also die H√§ufigkeiten der Wochentage grafisch darstellen
wollen, sieht der vollst√§ndige Befehl also so aus:

```{r}
#| label: fig-bar-tips
#| fig-cap: "S√§ulendiagramm der Variable `day` in der Datentabelle `tips`"

gf_bar( ~ day, data = tips)
```

Sie erkennen in @fig-bar-tips, dass am Samstag (`Sat`) die meisten Belege erfasst wurden, gefolgt von Sonntag (`Sun`) und Donnerstag (`Thur`). 
Freitag (`Fri`) liegt abgeschlagen auf dem letzten Platz.

::: {.callout-tip .Hinweis}
## Hinweis

Vielleicht haben Sie es schon gemacht. 
Bevor `gf_bar()` ausgef√ºhrt werden kann, muss das Paket `mosaic` mit dem Befehl `library(mosaic)` geladen werden.
:::

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Warum ist die Reihenfolge der Wochentage so *komisch*?
:::

Kategoriale Variable werden in R entweder als Zeichenkette (Variablentyp `chr`) oder (fr√ºher) als *sogenannter* Faktor abgespeichert (Variablentyp `factor`).
Bei Zeichenketten werden die Kategorien alphanumerisch aufsteigend sortiert. 
Wenn die Reihenfolge ge√§ndert werden soll, muss die Variable als Faktor gespeichert werden.
Wenn Sie die H√§ufigkeiten (englisch: *count*, Symbol $h_i$) aller Kategorien $i$ erhalten wollen, k√∂nnen Sie den Befehl `tally()` verwenden.

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

`tally` kommt aus dem Englischen.
Was ist eine passende √úbersetzung daf√ºr?
:::

```{r}
tally( ~ day, data = tips)
```

::: {.callout-tip .Tipp}
## Tipp
Sie sehen, der Aufbau der Befehle, insbesondere bei Verwendung des Pakets `mosaic`, ist immer gleich:
`~ Variable` -- Variable, die analysiert werden soll, `data = tips` -- Datentabelle, die verwendet werden soll.
:::

Um Anteile (englisch: *proportion*) darzustellen, k√∂nnen Sie die Option `format = "proportion"` erg√§nzen, f√ºr Prozentwerte entsprechend `format = "percent"`.

```{r}
tally( ~ day, data = tips, format = "prop")
```

::: {.callout-tip .Tipp}
## Tipp

Bei den meinsten Optionswerten, die als Zeichenkette in Anf√ºhrungzeichen eingegen werden, reicht es, weniger Buchstaben anzugeben, hier z. B. "prop" oder "per". Es muss nur eindeutig sein.
:::

::: {.callout-tip .Tipp}
## Tipp
An welcher Stelle die Option erg√§nzt wird, ist egal. 
Sie k√∂nnen also auch `tally( ~ day, format = "prop", data = tips)` schreiben.
Die einzelnen Abschnitte eines Funktionsaufrufs werden mit Kommata getrennt.
:::

Manchmal ist es notwendig, nur einen Wert auszugeben.
Dazu k√∂nnen Sie die Funktion `prop()` verwenden.

```{r}
prop( ~ day, data = tips)
```

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Kategorien bei `prop()`

a) Welche Kategorie wird angezeigt?
b) Warum?
c) Wie k√∂nnen Sie andere Kategorien anzeigen lassen?

Sie k√∂nnen das mit `?mosaic::prop` herausfinden.
:::

::: {.callout-tip .Tipp}
## Tipp

Das Fragezeichen zeigt die Hilfe zu einem Befehl an. 
Da diese Sequenz nicht in das R-Skript aufgenommen werden soll, geben Sie diese am
besten in der Konsole (das eigentlich R-Fenster) ein. 
Normalerweise finden Sie die Konsole in RStudio im Fenster unten links.
:::

::: {.callout-tip .Tipp}
## Tipp
`mosaic::` muss nicht unbedingt davor angegeben werden, aber so wird sichergestellt, dass nach der Hilfe f√ºr die Funktion aus dem Paket `mosaic` gesucht wird.
Wenn Sie nicht wissen, ob die Funktion aus einem nachtr√§glich geladenen Paket stammt, lassen Sie diesen Teil einfach weg.
:::

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Stellen Sie Verteilung der Tageszeit (Variable `time`) als S√§ulendiagramm und als (relative) H√§ufigkeitstabelle dar.
:::

### Zusammenhang zwischen kategorialen Variablen

Die Tageszeit variiert. 
Mit welchen Variablen h√§ngt das zusammen?
Sie k√∂nnen die Analysen, die wir bisher gemacht haben, auch nach einer weiteren Variable gruppieren (bedingen). 
Dazu wird die Formel mit einem senkrechten Strich | erg√§nzt.

::: {.callout-tip .Tipp}
## Tipp

Au√üer der Tilde ~ gibt es in den Formeln noch den Strich |, der die Grafik (oder andere Funktionen) in mehrere Gruppen aufteilt. 
Auch hier gibt es ein Tastenk√ºrzel:
Windows AltGr - <, Mac Alt - 7. 
Das sind jetzt aber auch schon alle (zumindest f√ºr die Formelnsyntax).
:::

Im Falle von time k√∂nnte beispielsweise ein Zusammenhang mit dem
Tag vorliegen:

```{r}
gf_bar( ~ time | day, data = tips)
```

Wie Sie sehen k√∂nnen, sind die Verteilungen der Tageszeit an den Tagen unterschiedlich. 
Am Samstag und Sonntag scheint es gar keine Besuche zur Mittagszeit gegeben zu haben (vielleicht hatte das Restaurant nur abends auf?), w√§hrend es am Donnerstag fast nur Besuche zur Mittagszeit gab.


Das gruppierte Verteilung k√∂nnen wir auch mit `tally()` darstellen, eine sogenannte Kreuztabelle:

```{r}
# absolut
tally( ~ time | day, data = tips)

# oder relativ als Anteil
tally( ~ time | day, data = tips, format = "prop")
```

Alternativ k√∂nnen Sie bei `tally()` auch folgenden Aufruf verwenden:

```{r}
tally(time ~ day, data = tips)
```

Das ist die Variante $Abh√§ngige\ Variable \sim Unabh√§ngige\ Variable$, bzw. $AV \sim UV$ oder $y \sim x$.

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Geht diese Variante auch bei `gf_bar()`? 
Probieren Sie es aus. 
Wenn nein, warum nicht?
:::

Wir haben jetzt die Grundstruktur (die Formelsyntax) der Befehle gelernt,
die mit Hilfe des Pakets `mosaic` in R durchgef√ºhrt werden k√∂nnen:

$AV \sim UV | GV$ -- abh√§ngige Variable in Abh√§ngigkeit von der unabh√§ngigen
Variablen ggf. gruppiert nach einer Gruppierungsvariable.

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

F√ºhren Sie eine Kreuztabellierung der Anteile der Raucher  je Wochentag durch.
Ist es egal, welche Variable die abh√§ngige bzw. die unabh√§ngige ist? 
Vergleichen Sie absolute und relative H√§ufigkeiten -- *richtigherum* und *falschherum*.
:::

Bei relativen H√§ufigkeiten m√ºssen Sie darauf achten, wovon der relative
Anteil ausgegeben wird: *Confusion of the inverse*:

- Der Anteil der Raucher am Freitag entspricht nicht dem Anteil des Freitags der Raucher.

- Der Papst ist ein Mann, aber nur die allerwenigsten M√§nner sind Papst.

- Die Wahrscheinlichkeit, krank zu sein, wenn das Testergebnis positiv ist, ist nicht dasselbe wie die Wahrscheinlichkeit, dass das Testergebnis positiv ist, wenn man krank ist.

### Bedingte und totaleWahrscheinlichkeit

Die relative H√§ufigkeit der Uhrzeit (Ereignis $A$) gegeben den Wochentag
(Ereignis $B$) k√∂nnen Sie auch als bedingte Wahrscheinlichkeit interpretieren,
z. B. `Pr(time = Lunch|day = Thur)`:

$$
Pr(ùê¥|ùêµ)
$$

Das w√§re in unserer Kreuztabelle `tally( ~ time | day, ...)` der zweite Wert aus der vierten Spalte: 0.983871.

```{r}
tally( ~ time | day, data = tips, format = "prop")
```

Einzelne Werte aus einem Vektor k√∂nnen Sie mit $[\#]$ auslesen, $\#$ gibt die Position im Vektor an. 
Bei einer Matrix wie oben ben√∂tigen Sie die Zeilen- und die Spaltennummer: $[\#, \#]$, getrennt durch ein Komma.

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Bestimmen Sie den Wert f√ºr $Pr(time = Lunch|day = Thur)$ mit `tally()`. 
Statt zwei Zahlen f√ºr die Zeile und die Spalte anzugeben, k√∂nnen Sie auch die Bezeichnungen, hier "`Lunch`" und "`Thur`" angeben.
:::

::: {.callout-tip .Tipp}
## Tipp

Die eckigen Klammern bekommen Sie auf Windows-Rechnern mit
AltGr-8 und auf Mac-Rechnern mit Alt-5.
:::

Um die totale Wahrscheinlichkeit f√ºr die Uhrzeit "`Lunch`" zu bestimmen, k√∂nnen Sie die einzelnen bedingten Wahrscheinlichkeiten multipliziert mit den jeweiligen Wahrscheinlichkeiten (Ereignisse $B_k, k=1, \dots,K$[^Formal m√ºssen die Ereignisse $B_k$ √ºberschneidungs frei sein und die Wahrscheinlichkeiten in der Summe eins ergeben.], welche die Bedingungen stellen, auf addieren:

$$
\begin{aligned}
Pr(A) &= Pr(A\mid B_1) \cdot Pr(B_1) + Pr(A\mid B_2) \cdot Pr(B_2) +  \cdots \\
      &= Pr(A\mid B_K) \cdot Pr(B_K)
\end{aligned}
$$

hier also:

$$Pr(time = Lunch) = Pr(time = Lunch\mid day = Thur) ¬∑ Pr(day = Thur)
+ Pr(time = Lunch\mid day = Fri) ¬∑ Pr(day = Fri) + \dots$$

```{r}
# Totale Wahrscheinlichkeit
( tally( ~ time | day, data = tips, format = "prop")["Lunch", ] *
tally( ~ day, data = tips, format = "prop") ) |> sum()

# Kontrolle
prop( ~ time, success = "Lunch", data = tips)
```


Ok, das sieht jetzt etwas kompliziert aus.
Was haben wir gemacht: 
Die erste Zeile liest die bedingten Wahrscheinlichkeiten f√ºr "`Lunch`" f√ºr alle Wochentage aus. 
Die zweite Zeile gibt die Wahrscheinlichkeiten (bzw. Anteile) f√ºr die Wochentage zur√ºck. 
Beide Zeilen wurden miteinander elementweise multipliziert und dann aufsummiert.

::: {.callout-tip .Hinweis}
## Hinweis

Die Multiplikation von Vektoren mit `*` in R geht elementweise vor, anders als in der Mathematik, da wird ein Zeilenvektor mit einem Spaltenvektor zu einem Skalarprodukt zusammengefasst. 
Das Skalarprodukt zweier Vektoren k√∂nnen Sie mit `%*%` berechnen, dann ben√∂tigen Sie kein `sum()` mehr. 
Probieren Sie es aus.
:::

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Bedingte und totale Wahrscheinlichkeit:

a) Wie hoch ist die Wahrscheinlichkeit f√ºr einen Rauchertisch beim Mittagessen?

b) Bestimmen Sie die totale Wahrscheinlichkeit f√ºr einen Nichtrauchertisch aus dem Zusammenhang mit der Uhrzeit.

:::

Mit dem **Satz von Bayes** und der totalen Wahrscheinlichlichkeit k√∂nnen wir die bedingten Wahrscheinlichkeiten umrechnen:

$$
Pr(B\mid A) = \frac{Pr(A\mid B) \cdot Pr(B)}{Pr(A)}.
$$

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Bestimmen Sie Wahrscheinlichkeit f√ºr Freitag bedingt Essenszeit Dinner √ºber den Satz von Bayes. 
Kontrollieren Sie das Ergebnis mit `tally()`.
:::

Auf dem Satz von Bayes basiert eine eigene Richtung in der Statistik, die *Bayes-Statistik*. 
Wir bleiben hier aber in der sogenannten *frequentistischen Statistik*.

### Grafische Darstellung des Zusammenhangs

Den Zusammenhang zwischen zwei kategorialen Variablen k√∂nnen Sie gut mit dem Mosaikplot darstellen: `mosaicplot(x ~ y, data = ...)`.

::: {.callout-tip .Hinweis}
## Hinweis

Im Aufruf von `mosaicplot()` sind die Variablen vertauscht: 
Die unabh√§ngige Variable muss als erstes angegeben werden, die abh√§ngige Variable als zweites.
:::

Hier der Mosaikplot zu Raucher je Wochentag:

```{r}
#| fig-cap: "Mosaikplot Raucher in Abh√§ngigkeit vom Wochentag. $x$ und $y$ m√ºssen im Aufruf von `mosaicplot()` vertauscht werden."
mosaicplot(day ~ smoker, data = tips)
```

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Beschreiben Sie einen Mosaikplot! 
Was genau wird in Richtung der $x$-Achse, was in Richtung der $y$-Achse dargestellt?
Was entspricht dem Fl√§chenanteil einer Kachel? 
Stellen Sie alle diese Information mit `tally()` dar.
:::

Auch mit einem S√§ulendiagramm k√∂nnen Sie Zusammenh√§nge darstellen.
Sie k√∂nnen die Farbe `(fill = ...)` nach einer anderen Variable ausw√§hlen, das ist dann die abh√§ngige Variable.

```{r}
#| fig-cap: "S√§ulendiagramm der Wochentage, farbig markiert sind die Anteile der Raucher und Nichtraucher innerhalb der Tage. Dabei wurden unterschiedlichen Varianten verwendet: links standard, mittig `position = position_dodge()` und rechts `position= \"fill\""
#| label: fig-drei-saeulen
gf_bar( ~ day, fill = ~ smoker, data = tips)
gf_bar( ~ day, fill = ~ smoker, data = tips, position = position_dodge())
gf_bar( ~ day, fill = ~ smoker, data = tips, position = "fill")
```


::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Mit welcher Grafik in @fig-drei-saeulen k√∂nnen Sie am besten erkennen, an welchem Tag ...

a) die Anzahl der Rauchergruppen am h√∂chsten war?

b) der Anteil der Rauchergruppen am h√∂chsten war?
:::

Sie sehen, die Positionierung der Aufteilung der Raucher innerhalb der Tage gibt unterschiedliche Informationen. 
H√§ufigkeiten erkennen Sie mit `position = position_dodge()` am besten (vgl. die Fl√§che der Kachel im Mosaikplot) und Anteile mit `position = "fill"` (vgl. die H√∂he der Kacheln im Mosaikplot).

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Nutzen Sie die Datentabelle SaratogaHouses.^[Wie kommen Sie daran? Siehe Abschnitt 2.3 (Erste Schritte in R) in Kapitel 2.]

a) F√ºhren Sie eine explorative Datenanalyse der Variable `heating` durch.

b) Analysieren Sie den Zusammenhang zwischen `heating` und `newConstruction`.
:::

::: {.callout-caution .Lernpfad}
## Lernpfad **Explorative Datenanalyse -- kategorial**

- Falls Sie bisher wenig mit R gearbeitet haben, k√∂nnen Sie auch die `learnr`-App ausprobieren: <https://fomshinyapps.shinyapps.io/learnR-EDA-kategorial/>.

- Kl√§ren Sie erforderlichenfalls Ihnen noch unbekannte Begriffe eigenst√§ndig.

- Zur Unterst√ºtzung gibt es zwei Screencasts: EDA ‚Äì Eine kategoriale Variable <https://vimeo.com/398513368> und EDA -- Zwei kategoriale Variablen <https://vimeo.com/398789025>. Die Videos erfordern ein Passwort: *FOMtest*.

- Lesen Sie zur Vertiefung Kapitel 8.1.1 aus Sebastian Sauer *Moderne Datenanalyse mit R* [@sauer2019]. Das Buch steht √ºber die FOM-Literaturrecherche zur Verf√ºgung.

- Erg√§nzend k√∂nnen Sie das Kapitel 4 *Exploring categorical data* aus *Introduction to Modern Statistics* [@mine2021] lesen. Sie k√∂nnen es hier herunterladen: <https://openintro-ims.netlify.app/index.html>
:::

## Analyse metrischer Daten

Im diesem Abschnitt geht es um die Analyse metrischer oder numerischer Daten.

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Wissen Sie noch, wie Sie mit R herausfinden konnten, wie unser Datensatz aufgebaut ist? 
Probieren Sie es aus. 
Wie viele metrische Variablen gibt es in der Datentabelle tips?
:::

### Histogramm und Verteilungsform

Als Grafik k√∂nnen auch hier S√§ulen- und Balkendiagramme verwendet werden. 
Diese eignen sich insbesondere f√ºr metrisch diskrete Daten mit nicht zu vielen Auspr√§gungen (in der `tips`-Datentabelle z. B. die Anzahl der Personen `size`).
Eine weitere wichtige und h√§ufig genutzte Grafik ist das Histogramm :

```{r}
#| fig-cap: Histogramm der Variable `total_bill`
#| label: fig-hist-total-bill
gf_histogram( ~ total_bill, data = tips, binwidth = 10, center = 5)
```

@fig-hist-total-billzeigt das Histogramm der Rechnungsbetr√§ge (`total_bill`).
Metrische Daten (insbesondere stetige metrische Daten) werden in Gruppen
eingeteilt (`klassifiziert`), z. B. $0 bis 10$, $> 10$ bis $20$, . . . , und die H√§ufigkeiten als Rechtecke (S√§ulen) dargestellt.
Der Fl√§cheninhalt der Rechtecke entspricht dabei der relativen H√§ufigkeit der Beobachtungen im Intervall (die sogenannte *Klasse*).
Im Unterschied zum S√§ulendiagramm stehen die einzelnen S√§ulen jetzt direkt nebeneinander. 
Das soll zeigen, dass es sich um stetige und nicht um diskrete Daten handelt.

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Probieren Sie den Befehl ohne die Eingabe von `binwidth = 10, center = 5` aus.
Was √§ndert sich?
:::

Richtig, jetzt werden viel mehr S√§ulen gezeigt. 
`gf_histogram()` w√§hlt automatisch eine bestimmte Breite und nimmt den kleinsten Wert als Startwert. 
Wenn Sie weniger S√§ulen (englisch *bins*) haben wollen, erg√§nzen Sie z. B. `bins = 10` (Anzahl der S√§ulen).
Und wenn Sie ganz bestimmte Gruppen haben wollen, dann nutzen Sie `binwidth` f√ºr die Breite der S√§ule und `center` f√ºr den Mittelpunkt einer der S√§ulen.

::: {.callout-tip .Tipp}
## Tipp

Mehr Informationen zu Histogrammen finden Sie hier: <http://tinlizzie.org/histograms/>.
:::

Ein Histogramm kann dazu genutzt werden, die Form der Verteilung zu
bestimmen. @fig-Distributions zeigt typische Formen. 
Die Verteilungsform ist eine wichtige Eigenschaft von Daten.

```{r}
#| label: fig-Distributions
#| fig-cap: "Verschiedene Verteilungsformen. Bei bimodalen und multimodalen Verteilungen werden nur die ausgepr√§gten Schwerpunkte gez√§hlt."
#| echo: false
#| fig-width: 4.5
#| fig-asp: 0.7
#| out-width: 10.5cm

source("./misc/Fleishman.R")

n <- 10000

xn <- rnorm(n = n)
nor <- data.frame(Verteilung = "Symmetrisch (Normal)", x = xn)

xls <- rfleish(n = n, skew = -0.65)
xrs <- rfleish(n = n, skew = 0.65)
st <- c(rep("Linksschief", n), rep("Rechtsschief", n))
x <- c(xls, xrs)
schiefe <- data.frame(Verteilung = st, x = x)

xl <- rnorm(0.65*n, mean = -1,sd = 0.5)
xr <- rnorm(0.35*n, mean = 1, sd = 0.5)
xmm <- c(xl,xr)
xmm <- (xmm - mean(xmm))/sd(xmm)
bimod <- data.frame(Verteilung = "Bimodal", x = xmm)

x1 <- rnorm(0.35*n, mean = -1,sd = 0.5)
x2 <- rnorm(0.25*n, mean = 3, sd = 1)
x3 <- rnorm(0.40*n, mean = -5, sd = 0.5)
xmm <- c(x1,x2,x3)
xmm <- (xmm - mean(xmm))/sd(xmm)
multimod <- data.frame(Verteilung = "Multimodal", x = xmm)

xg <- runif(n)
xg <- (xg - mean(xg))/sd(xg)
gleich <- data.frame(Verteilung = "Gleichverteilung", x = xg)

dat <- rbind(nor, schiefe,  bimod, multimod, gleich)
dat <- dat |> mutate(Verteilung = factor(Verteilung, levels = c("Symmetrisch (Normal)", "Linksschief", "Rechtsschief", "Gleichverteilung", "Bimodal", "Multimodal")))

gf_histogram( ~ x | Verteilung, data = dat) |> 
  gf_theme(axis.text = element_blank(), 
           axis.text.y = element_blank(), 
           axis.title.x = element_blank(), 
           axis.title.y = element_blank(), 
           axis.ticks = element_blank(),
           plot.margin = gg0margins)
```

Die Verteilung gibt an, wie h√§ufig bzw. wahrscheinlich bestimmte Werte oder Wertebereiche sind.
Bei metrischen Variablen k√∂nnen folgende typische Verteilungsformen unterschieden werden:

- Bei symmetrischen Verteilungen verteilen sich die Daten symmetrisch um eine zentrale Lage. H√§ufig sind symmetrische Verteilungen unimodal, haben als nur einen ausgepr√§gten Schwerpunkt.

- Schiefe: Bei rechtsschiefen (linkssteilen)Verteilungen sind mehr Beobachtungen im unteren Wertebereich, bei linksschiefen (rechtssteilen) mehr im oberen.

- Bei einer Gleichverteilung sind die Auspr√§gungen alle etwa gleich h√§ufig.

- Bei mehrgipfligen Verteilungen (bimodal, multimodal) gibt es mehr als nur ein ausgepr√§gtes Zentrum, um das die Werte streuen.

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

√úberlegen Sie sich ein Beispiel f√ºr gleichverteilte Daten.
:::

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Wie wird wohl das Einkommen in Deutschland verteilt
sein?
:::

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Betrachten Sie noch einmal @fig-hist-total-bill. 
Beschreiben Sie die Verteilung von `total_bill`.
:::

Ein Histogramm zeigt die Verteilung von metrischen Daten.
Wenn Sie das als stetige Funktion darstellen (Sie verbinden quasi die Mitten der Oberkanten der Rechtecke), erhalten Sie die Dichtefunktion. 
@fig-Dens zeigt beide Grafen √ºbereinander.^[Das Histogramm hat als Skalierung auf der $y$-Achse jetzt die Dichte (H√§ufigkeitsanteil der Klasse geteilt durch Klassenbreite). Die verwendeten Funktionen sind `gf_dhistogram()` und `gf_dens()`.]

```{r}
#| echo: false
#| label: fig-Dens
#| fig-width: 3.5 
#| fig-asp: 1
#| out-width: 7cm


gf_dhistogram( ~ total_bill, data = tips, bins = 9) |> 
  gf_dens(color = fgcolFOMGreen, size = 1, alpha = 1) |> 
  gf_theme(plot.margin = gg0margins)
```

H√§ufig verwendet wird die Verteilungsfunktion, die das Integral der Dichtfunktion ist. 
Die **empirische Verteilungsfunktion**^[Neben der *empirischen* Verteilungsfunktion gibt es auch eine *theoretische* Verteilungsfunktion $F(x)$] $F_n(x)$ gibt an, wie hoch der Anteil unter den $n$ Beobachtungen ist, die kleiner oder gleich $x$ sind. 
@fig-EmpDist zeigt als Beispiel die empirische Verteilungsfunktion der Rechnungsh√∂he.

$$
F_n(x) = \frac{\text{Anzahl Beobachtungen} \leq x}{x}
$$

Sie sehen, die Verteilungsfunktion gibt auf der $y$-Achse den Anteil der Beobachtungen aus, der kleiner oder gleich dem Wert auf der $x$-Achse ist.
F√ºr einen konkreten Wert $x$ k√∂nnen Sie den Wert der Verteilungsfunktion mit `pdata()` ermitteln:

```{r}
pdata( ~ total_bill, q = 10, data = tips)
```

Der Parameter $q$ ist das Quantil (dazu gleich mehr), also der Wert f√ºr $x$ in der Formel.

```{r}
#| fig-cap: "Empirische Verteilungsfunktion von `total_bill`"
#| label: fig-EmpDist
#| echo: FALSE
#| fig-width: 3.5
#| fig-asp: 1
#| out-width: 7cm
gf_ecdf( ~ total_bill, data = tips, color = fgcolFOMGreen, size = 1) |> 
  gf_labs(x = TeX("x", italic = TRUE), y = TeX("$F_n(x)$", italic = TRUE)) |> 
  gf_theme(plot.margin = gg0margins)

```

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Gerundet hat sich f√ºr $F_n(10)$ der Wert $0.07$ ergeben. 
Welche Aussage stimmt in diesem Zusammenhang?

a) Der Anteil einer Rechnungsh√∂he von 10 $ liegt bei $0.07$.

b) Der Anteil einer Rechnungsh√∂he von mindestens 10 $ liegt bei $0.07$.

c) Der Anteil einer Rechnungsh√∂he von h√∂chstens 10 $ liegt bei $0.07$.
:::

::: {.callout-note .Aufgabe}
## Aufgabe `r quiz <- quiz + 1; paste0(ch, ".", quiz)`

Es gibt keine Verteilungsfunktion f√ºr nominalskalierte Daten. 
Warum nicht?
:::


### Lagema√üe

Zun√§chst besch√§ftigen wir uns mit den Lagema√üen einer Verteilung. 
Lagema√üe beschreiben die Lage einer Verteilung, also wo ist der Schwerpunkt,
das Minimum, das Maximum usw. 
Eine Verteilung einer metrischen Variablen k√∂nnen Sie gut mit einem Histogramm darstellen und damit k√∂nnen Sie auch ungef√§hr absch√§tzen, wo der Schwerpunkt, das Maximum usw. sind. 
Lagema√üe druÃàcken das alsWert aus und sind somit gewisserma√üen Kennzahlen.

